from ROOT import TFile,TTree,TCanvas,TH2F
import os

########################
#Constants
########################


cutString_Pixel5_3 = "x_dut[2] > 19 && x_dut[2] < 21 && y_dut[2] > 23 && y_dut[2] < 25"
cutString_Pixel5_4 = "x_dut[2] > 18 && x_dut[2] < 20 && y_dut[2] > 23 && y_dut[2] < 25"
cutString_Pixel5_10 = "x_dut[2] > 19 && x_dut[2] < 21 && y_dut[2] > 22.5 && y_dut[2] < 24.5"

#Pixel5_3 : Run 16428
#Pixel5_4 : Run 17261
#Pixel5_10: Run 16725

runList_CACTUSDigital_HighThreshold = [16428, 16430, 16433, 16434, 16437, 16438, 16439, 16440, 16441, 16443, 16444, 16445, 16446, 16447, 16448, 16449, 16450, 16451, 16452, 16453, 16454]
runList_CACTUSDigital_LowThreshold = [16467, 16468, 16469, 16470, 16471, 16482, 16483, 16487, 16488]
runList_CACTUSDigital_TimingOptimized_HighThreshold = [16492, 16493, 16494, 16495, 16497, 16498, 16499, 16500, 16510, 16512, 16514]
runList_CACTUSAnalog_Pixel5_3_HighGain = [16719, 16720, 16721, 16722, 17040, 17042, 17043, 17044, 17045, 17046, 17047, 17048, 17049, 17050, 17051, 17052, 17053, 17054, 17055, 17057, 17058, 17059, 17060, 17061, 17062]

runList_CACTUSDigital_TimingOptimized_LowThreshold = [16517, 16519, 16521, 16523, 16525, 16527, 16529, 16531, 16533, 16537, 16539, 16540, 16542, 16544, 16545, 16547, 16548, 16549, 16551, 16553, 16555, 16556, 16557, 16559, 16561, 16562, 16564, 16567, 16568, 16569, 16570, 16571, 16575, 16576, 16577, 16579, 16581, 16582, 16583, 16584, 16585, 16586, 16587, 16588, 16589, 16590, 16593, 16594, 16595, 16597, 16598, 16600, 16601, 16603, 16604, 16605, 16606, 16607, 16608, 16609, 16610, 16611, 16612, 16613, 16614, 16615, 16616, 16617, 16618, 16619, 16620, 16621, 16622, 16623, 16624, 16625, 16632, 16634, 16635, 16636, 16637, 16638, 16639, 16640, 16641, 16642, 16657, 16661, 16663, 16664, 16665, 16666, 16667, 16668, 16669, 16670, 16671, 16672, 16675, 16676, 16677, 16678, 16679, 16680, 16681, 16683, 16684, 16685, 16686, 16687, 16688, 16689, 16690, 16691, 16693, 16694, 16695, 16697, 16698, 16699, 16700, 16701, 16702, 16703, 16704, 16706, 16707, 16708, 16709, 16710, 16711]

runList_CACTUSAnalog_Pixel5_4 = [17063, 17064, 17065, 17066, 17067, 17068, 17069, 17070, 17071, 17072, 17073, 17074, 17075, 17076, 17078, 17079, 17080, 17081, 17082, 17083, 17085, 17086, 17087, 17088, 17089, 17090, 17091, 17093, 17094, 17095, 17097, 17098, 17099, 17100, 17112, 17113, 17114, 17115, 17116, 17117, 17118, 17119, 17120, 17121, 17122, 17123, 17124, 17125, 17126, 17128, 17130, 17131, 17132, 17133, 17134, 17135, 17136, 17138, 17139, 17140, 17141, 17142, 17144, 17145, 17146, 17148, 17149, 17150, 17151, 17152, 17153, 17154, 17155, 17156, 17158, 17159, 17160, 17161, 17162, 17163, 17164, 17165, 17166, 17167, 17168, 17169, 17170, 17171, 17173, 17178, 17180, 17182, 17186, 17188, 17190, 17192, 17194, 17196, 17198, 17200, 17202, 17206, 17208, 17210, 17212, 17214, 17219, 17223, 17225, 17227, 17229, 17231, 17233, 17235, 17239, 17243, 17245, 17247, 17251, 17253, 17255, 17257, 17259, 17261, 17263, 17265, 17267, 17309, 17311, 17313, 17315, 17317, 17319, 17324, 17326, 17331, 17333, 17338, 17343, 17347, 17348, 17362]

#runList_CACTUSAnalog_Pixel5_3 = [16216, 16217, 16219, 16220, 16223, 16239, 16240, 16248, 16249, 16250, 16252, 16253, 16254, 16255, 16256, 16257, 16258, 16259, 16261, 16262, 16263]
runList_CACTUSAnalog_Pixel5_3 = [16217]

runList_CACTUSAnalog_Pixel5_10 = [16725, 16726, 16728, 16734, 16738, 16740, 16741, 16743, 16744, 16746, 16749, 16753, 16754, 16755, 16758, 16759, 16760, 16761, 16764, 16767, 16768, 16769, 16770, 16771, 16772, 16773, 16774, 16776, 16778, 16780, 16786, 16788, 16789, 16791, 16792, 16794, 16798, 16799, 16801, 16806, 16812, 16814, 16815, 16816, 16817, 16818, 16819, 16820, 16822, 16824, 16825, 16831, 16833, 16835, 16836, 16838, 16841, 16843, 16845, 16847, 16849, 16851, 16854, 16856, 16858, 16860, 16881, 16882, 16883, 16884, 16885, 16886, 16887, 16888, 16889, 16890, 16891, 16892, 16893, 16894, 16895, 16897, 16898, 16899, 16900, 16902, 16903, 16904, 16905, 16906, 16907, 16909, 16911, 16942, 16943, 16944, 16945, 16946, 16947, 16949, 16950, 16951, 16952, 16953, 16954, 16955, 16956, 16957, 16958, 16959, 16960, 16965, 16966, 16967, 16968, 16969, 16970, 16972, 16973, 16975, 16976, 16977, 16978, 16979, 16980, 16989, 16990, 16992, 16993, 16999, 17000, 17001, 17002, 17003, 17004, 17005, 17007, 17008, 17010, 17011, 17012, 17017, 17018, 17020, 17021, 17022, 17023, 17024, 17025, 17026, 17027, 17028, 17029, 17031, 17032, 17033, 17034, 17035, 17036, 17037, 17038, 17039]


########################
#Skim Configuration
########################
cutString = cutString_Pixel5_10
runList = runList_CACTUSAnalog_Pixel5_10

print "Run Skimming on runs:"
print runList
print "using cutString \"" + cutString + "\""
print "\n\n"


########################
#Start Skimming
########################

for Run in runList:
    print "Run "+str(Run)
    inputfileName = "/eos/uscms/store/user/cmstestbeam/2019_04_April_CMSTiming/KeySightScope/RecoData/TimingDAQRECO/RecoWithTracks/v6/run_scope"+str(Run)+"_converted.root"
    outputfileName = "/eos/uscms/store/user/cmstestbeam/2019_04_April_CMSTiming/KeySightScope/RecoData/TimingDAQRECO/RecoWithTracks/v6_CACTUSSkim/run_scope"+str(Run)+"_converted.root"

    if not os.path.exists(inputfileName):
        print "input file "+inputfileName+" does not exist"
        continue
 
    file = TFile(inputfileName)
    tree = file.Get("pulse")
    print "opened file "+inputfileName+" with "+str(tree.GetEntries())+" Events"

    outfile = TFile(outputfileName,"RECREATE")
    newTree = tree.CopyTree(cutString)    
    print "wrote output file"+outputfileName+" with "+str(newTree.GetEntries())+" Events"

    outfile.Write()
    outfile.Close()


    file.Close()
